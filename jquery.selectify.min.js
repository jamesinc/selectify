/*jshint jquery:true */
/**
 * Selectify - an unobtrusive select overlay that reproduces the
 * native <select> element experience Pretty Well(TM).
 * 
 * by James Ducker <james.ducker+js@gmail.com>
 * 
 * Works with jQuery >= 1.7
 *
 * "Add-and-forget" - manipulate your underlying <select> element
 * and changes are immediately propagated to Selectify's overlay.
 *
 * Project home: https://github.com/jamesinc/selectify
 * Issue tracker: https://github.com/jamesinc/selectify/issues
 */
(function(e){"use strict";var t={duration:50,autoWidth:!0,btnText:"â–¼",classes:{container:"sl-container",placeholderContainer:"sl-placeholder-container",placeholder:"sl-placeholder",btn:"sl-button",options:"sl-options",selected:"sl-selected",open:"sl-open"}};e.fn.selectify=function(s){var n,a=function(t){var s="",n="",a=null,l={},o=function(){n=""},i=function(){t.html()!==s&&(e.each(t.find("option"),function(){var t=e(this);t.text().length&&(l[t.text()]=t.val())}),s=t.html())},c=function(){clearTimeout(a),a=setTimeout(o,1e3)};return{find:function(s){var a,o=e(t.find("option").get(t.get(0).selectedIndex)),r=!1;return i(),c(),n+=s,a=n.length,o.length&&o.text().substr(0,a).toUpperCase()===n||a&&e.each(l,function(e,t){return e.substr(0,a).toUpperCase()===n?(r=t,!1):void 0}),r},clear:function(){clearTimeout(a),o()}}};return s=s||{},n=e.extend(!0,{},t,s),this.each(function(){var t,s,l,o,i,c,r,d=e(this),u=new a(d),h=this;d.is("select")&&(d.data("sl")===!0&&d.next("."+n.classes.container).remove(),t=d.find("option"),s=e("<div/>",{"class":n.classes.container,css:{position:"relative"}}),l=e("<div/>",{"class":n.classes.placeholderContainer,tabindex:0}),o=e("<div/>",{"class":n.classes.placeholder}),i=e("<div />",{"class":n.classes.btn,text:n.btnText,css:{position:"absolute",right:0,top:0,height:"100%"}}),l.append(o,i),c=e("<ul/>",{"class":n.classes.options,css:{position:"absolute",left:0}}),t.each(function(){var t=e(this),a=e("<a/>",{href:"#",text:t.text(),css:{"white-space":"nowrap"},click:function(e){e.preventDefault(),d.val()!==t.val()&&(o.text(t.text()),c.find("a").removeClass(n.classes.selected),a.addClass(n.classes.selected),d.val(t.val()).trigger("change",[{sl:!0}])),c.slideUp(n.duration),s.removeClass(n.classes.open)}}),l=e("<li/>");l.append(a),c.append(l)}),l.on("click",function(e){e.preventDefault(),c.slideToggle(n.duration),s.toggleClass(n.classes.open),d.trigger("change")}),l.on("keydown",function(e){var s,a=e.which,l=String.fromCharCode(a),o=!1,i=h.selectedIndex;return(40===a||39===a)&&(o=!0,h.selectedIndex=Math.min(t.length-1,h.selectedIndex+1)),(38===a||37===a)&&(o=!0,h.selectedIndex=Math.max(0,h.selectedIndex-1)),o?(e.preventDefault(),i!==h.selectedIndex&&(u.clear(),d.trigger("change")),!1):((13===a||32===a)&&c.slideUp(n.duration),/[a-zA-Z0-9-_ !@#$%^&*\(\)+\/\\?><;:'"|]/.test(l)&&(s=u.find(l),s&&d.val()!==s&&d.val(s).trigger("change")),void 0)}),l.on("selectstart",function(){return!1}),e(document).on("mouseup",function(e){s.has(e.target).length||(c.slideUp(n.duration),s.removeClass(n.classes.open))}),d.on("change",function(s,a){var l=this.selectedIndex,i=Math.abs(c.scrollTop()),d=e(r.get(l)),u=parseInt(c.css("border-top-width"),10),h=d.offset().top-r.first().offset().top;i>h?c.clearQueue().animate({scrollTop:u+h},n.duration):h>i+c.height()-d.outerHeight()&&c.clearQueue().animate({scrollTop:u+h-c.height()+d.outerHeight()},n.duration),a&&a.sl||(o.text(e(t.get(l)).text()),r.removeClass(n.classes.selected),d.addClass(n.classes.selected))}),r=c.find("a"),o.text(e(t.get(d[0].selectedIndex)).text()),e(r.get(d[0].selectedIndex)).addClass(n.classes.selected),n.autoWidth&&o.width(d.width()),s.append(l,c),d.hide().after(s).data("sl",!0),c.hide().css("top",s.outerHeight()))}),this}})(jQuery);